import{d as R,a9 as B,ao as M,a8 as t,al as F,an as k,o as f,b as C,j as o,e as c,w as d,h as i,t as L,F as V,i as E,g as D,E as q,G as U,f as G,am as H,a6 as I,s as J,u as O}from"./entry.b43c92c6.js";import K from"./column.esm.01b3d724.js";import Q from"./datatable.esm.13eaee02.js";import{_ as W}from"./_plugin-vue_export-helper.c27b6911.js";import"./entry.4b682d46.js";import"./paginator.esm.63312315.js";import"./index.esm.d4ec6485.js";import"./dropdown.esm.2e2da269.js";import"./index.esm.2c99e938.js";import"./virtualscroller.esm.000d59bf.js";import"./inputnumber.esm.1464a017.js";import"./index.esm.c115113b.js";import"./index.esm.eec300d9.js";import"./inputtext.esm.5c0cdec0.js";import"./index.esm.db3af8d3.js";import"./index.esm.51fd65cb.js";import"./index.esm.0c14803b.js";import"./index.esm.215330f1.js";import"./index.esm.7571de83.js";const X={class:"grid crud-demo"},Y={class:"col-12"},Z={class:"card card-sm"},ee={class:"table-header flex justify-content-between flex-wrap"},te={class:"flex align-items-center justify-content-center"},ae={class:"flex align-items-center justify-content-center"},se={class:"mb-2 md:m-0 p-as-md-center"},oe={class:"flex align-items-center justify-content-center"},ie=["onClick"],ne=R({__name:"NotificationList",props:{columns:{type:Array,default:()=>[]},url:{type:String,default:"/api/notification"},rows:{type:Number,default:5}},emits:["closeDialog"],setup(u,{emit:_}){const b=u;B(()=>{n.value=!0,window.Echo.private("user."+M().$state.user.id).notification(e=>{e.type==="ticket.comment"&&p()}),p()});const w=t(),S=t("Notification"),n=t(!1);t(!1);const a=t(),h=t(null);t({});const m=F(),x=t(0),r=t(!1);t({name:{value:"",matchMode:"contains"},company:{value:"",matchMode:"contains"}});const P=t({}),p=()=>{n.value=!0,k(b.url,{method:"get",params:{options:JSON.stringify(P.value)}}).then(e=>{h.value=e.data,x.value=e.total,n.value=!1}).catch(e=>{n.value=!1,m.add({severity:"error",summary:e.data.status,detail:e.data.message,life:3e3})})},j=e=>{e.checked?(r.value=!0,a.value=h.value):(r.value=!1,a.value=[])},A=()=>{r.value=a.value.length===x.value},T=()=>{r.value=!1},$=()=>{n.value=!0,k("/api/notification/1",{method:"post",body:{notifications:a.value}}).then(e=>{m.add({severity:"success",summary:e.status,detail:e.message,life:3e3}),p()}).catch(e=>{m.add({severity:"error",summary:e.data.status,detail:e.data.message,life:3e3})}).finally(()=>{n.value=!1})},N=e=>{k("/api/notification/"+e.id,{method:"post",body:{notifications:[e]}}).then(l=>{_("closeDialog"),I().push({path:"/ticket/form",query:{source_token:e.data.ticket.source_token}})}).catch(l=>{m.add({severity:"error",summary:l.data.status,detail:l.data.message,life:3e3})})};return(e,l)=>{const y=J,v=K,z=Q;return f(),C("div",X,[o("div",Y,[o("div",Z,[c(z,{ref_key:"dt",ref:w,selection:i(a),"onUpdate:selection":l[0]||(l[0]=s=>H(a)?a.value=s:null),value:i(h),"data-key":"id","filter-display":"row",class:"p-datatable-sm","select-all":i(r),"show-gridlines":"",paginator:!0,rows:u.rows,"resizable-columns":!1,"paginator-template":"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown","rows-per-page-options":[5,10,25],"current-page-report-template":"Showing {first} to {last} of {totalRecords} data","column-resize-mode":"fit","global-filter-fields":["name","country.name","company","representative.name"],"responsive-layout":"scroll",onSelectAllChange:j,onRowSelect:A,onRowUnselect:T},{header:d(()=>[o("div",ee,[o("span",te,[c(y,{label:"Mark As Read",icon:"pi pi-check",class:"p-button-success p-button-sm",disabled:!i(a)||!i(a).length,loading:i(n),onClick:$},null,8,["disabled","loading"])]),o("span",ae,[o("h5",se,L(i(S)),1)]),o("span",oe,[c(y,{type:"button",icon:"pi pi-refresh",class:"p-button-sm p-button-success",onClick:p})])])]),default:d(()=>[c(v,{"selection-mode":"multiple","header-style":"width: 3em"}),(f(!0),C(V,null,E(u.columns,s=>(f(),D(v,{key:s.field,field:s.field,header:s.header,style:U({width:s.width}),sortable:!0},q({_:2},[s.field==="data.ticket.ticket_number"?{name:"body",fn:d(g=>[o("span",{onClick:ce=>N(g.data)},L(g.data.data.ticket.ticket_number),9,ie)]),key:"0"}:void 0]),1032,["field","header","style"]))),128)),c(v,{exportable:!1,style:{width:"4rem"}},{header:d(()=>[G(" View ")]),body:d(s=>[c(y,{icon:"pi pi-search",type:"button",class:"p-button-text",onClick:g=>N(s.data)},null,8,["onClick"])]),_:1})]),_:1},8,["selection","value","select-all","rows","global-filter-fields"])])])])}}});const le=W(ne,[["__scopeId","data-v-e51a112e"]]),De=R({__name:"index",setup(u){O({title:"Notifications"});const _=t([{field:"data.ticket.ticket_number",header:"Ticket No"},{field:"data.subject",header:"Subject"},{field:"data.ticket.title",header:"Ticket"},{field:"data.ticket.date_created",header:"Request Date"},{field:"read_at",header:"Read At"}]);return(b,w)=>(f(),D(le,{columns:i(_),url:"/api/notification",rows:10},null,8,["columns"]))}});export{De as default};
