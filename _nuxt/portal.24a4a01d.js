import{aq as g,ar as m,a8 as y,ao as o,as as U,at as i,ah as _}from"./entry.b43c92c6.js";import"./entry.4b682d46.js";const $=g(async k=>{let e,t;const s=_(),p=m(),w=y([]),h=a=>{try{return!!new URL(a)}catch{return!1}},d=a=>h(a)?a:window.location.protocol+"//"+window.location.host+a,r=d(s.public.ePortalUrl),n=d(s.public.ePortalApiUrl),b=async()=>{await o().logout(),window.location.href=r+"/logout?service="+s.public.baseUrl};try{o().$storage.setState("app.default_name",s.public.appName),o().$storage.removeState("sessions_key");const a=U("portal.session",{sameSite:!0,path:s.public.baseUrl});a.value||(p.query.session_key?a.value=p.query.session_key:window.location.href=r+"/visitordirect?token="+s.public.portalToken),console.log(n);const l=([e,t]=i(()=>$fetch("/api/auth/session",{baseURL:n,params:{sessions_key:a.value}})),e=await e,t(),e);if(l.data.session){if(o().$storage.setState("sessions_key",a.value),!o().$state.loggedIn){const c=([e,t]=i(()=>$fetch("/api/auth/me",{baseURL:n,headers:{Authorization:"Bearer "+l.data.session.bearer_token}})),e=await e,t(),e);if(c.status){const f=([e,t]=i(()=>o().loginWith("local",{body:{username:c.data.user.username,cherry_token:c.data.user.cherry_token,sessions_key:a.value,language:"en",app_name:s.public.appName}})),e=await e,t(),e);if(!f.data.token)alert(f.data.message);else{const u=([e,t]=i(()=>$fetch("/api/auth/session",{method:"get",baseURL:s.public.baseApi,params:{sessions_key:a.value,token:s.public.portalToken}})),e=await e,t(),e);u.data.status===!0?(w.value=u.data.list_app,window.location=s.public.baseUrl,u.data.app||(window.location.href={}.eportalUrl)):([e,t]=i(()=>b()),await e,t())}}}}else window.location.href=r+"/login?service="+s.public.baseUrl}catch(a){console.log(a.data),setTimeout(()=>{a.data&&(alert(a.data.message),window.location.href=r+"/login?service="+s.public.baseUrl)},500)}});export{$ as default};
