import{ao as g,ad as m,a5 as y,al as t,as as U,ap as i,a6 as _}from"./entry.b9153a06.js";import"./entry.7291cd7f.js";const $=g(async k=>{let e,o;const s=_(),p=m(),w=y([]),h=a=>{try{return!!new URL(a)}catch{return!1}},d=a=>h(a)?a:window.location.protocol+"//"+window.location.host+a,r=d(s.public.ePortalUrl),l=d(s.public.ePortalApiUrl),b=async()=>{await t().logout(),window.location.href=r+"/logout?service="+s.public.baseUrl};try{t().$storage.setState("app.default_name",s.public.appName),t().$storage.removeState("sessions_key");const a=U("portal.session",{sameSite:!0,path:s.public.baseUrl});a.value||(p.query.session_key?a.value=p.query.session_key:window.location.href=r+"/visitordirect?token="+s.public.portalToken),console.log(l);const n=([e,o]=i(()=>$fetch("/api/auth/session",{baseURL:l,params:{sessions_key:a.value}})),e=await e,o(),e);if(n.data.session){if(t().$storage.setState("sessions_key",a.value),!t().$state.loggedIn){const c=([e,o]=i(()=>$fetch("/api/auth/me",{baseURL:l,headers:{Authorization:"Bearer "+n.data.session.bearer_token}})),e=await e,o(),e);if(c.status){const f=([e,o]=i(()=>t().loginWith("local",{body:{username:c.data.user.username,cherry_token:c.data.user.cherry_token,sessions_key:a.value,language:"en",app_name:s.public.appName}})),e=await e,o(),e);if(!f.data.token)alert(f.data.message);else{const u=([e,o]=i(()=>$fetch("/api/auth/session",{method:"get",baseURL:s.public.baseApi,params:{sessions_key:a.value,token:s.public.portalToken}})),e=await e,o(),e);u.data.status===!0?(w.value=u.data.list_app,window.location=s.public.baseUrl,u.data.app||(window.location.href={}.eportalUrl)):([e,o]=i(()=>b()),await e,o())}}}}else window.location.href=r+"/login?service="+s.public.baseUrl}catch(a){console.log(a.data),setTimeout(()=>{a.data&&(alert(a.data.message),window.location.href=r+"/login?service="+s.public.baseUrl)},500)}});export{$ as default};
